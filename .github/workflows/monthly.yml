name: Monthly Python run

on:
  schedule:
    # GitHub cron is UTC. UK is UTC+1 in summer (BST), UTC+0 in winter (GMT)
    - cron: "15 12 2 * *"   # 13:15 UK during BST (summer)
    - cron: "15 13 2 * *"   # 13:15 UK during GMT (winter)
  workflow_dispatch: {}    # lets you run it manually

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Download the code from your repo
        uses: actions/checkout@v4

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Python libraries
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Create Google service account JSON file from secret
        run: |
          echo '${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}' > service_account.json

      # Optional safety check (keeps scheduled + manual consistent)
      - name: Only continue if it is 13:15 in Europe/London
        run: |
          if [ "$(TZ=Europe/London date +%H:%M)" != "13:15" ]; then
            echo "Not 13:15 in London; stopping."
            exit 0
          fi

      - name: Run your script
        env:
          PYTHONUNBUFFERED: "1"
        run: |
          python fetch_incompleteRTT_ICB.py
